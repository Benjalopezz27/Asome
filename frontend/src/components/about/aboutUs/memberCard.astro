---
import type { TeamMember } from "@/types";
import LinkedinIcon from "@/components/shared/icons/linkedinIcon.astro";
import { getImageUrl } from "@/lib/globalData";

interface Props {
  member: TeamMember;
}

const { member } = Astro.props;

const imageObj = Array.isArray(member.memberPicture)
  ? member.memberPicture[0]
  : member.memberPicture;
const imageUrl = getImageUrl(imageObj?.url);
---

<div
  class="group h-112 w-full perspective-[1000px] flip-card-container cursor-pointer"
>
  <div
    class="flip-card-inner relative h-full w-full transition-all duration-700 transform-3d group-hover:transform-[rotateY(180deg)] [&.is-flipped]:transform-[rotateY(180deg)]"
  >
    <div class="absolute inset-0 h-full w-full backface-hidden overflow-hidden">
      {
        imageUrl ? (
          <img
            src={imageUrl}
            alt={member.name}
            class="h-[78%] w-full object-cover object-center rounded-xl mb-8"
          />
        ) : (
          <div class="h-full w-full bg-[#D9D9D9] flex items-center justify-center">
            <span class="text-gray-400">Sin foto</span>
          </div>
        )
      }

      <div class="absolute bottom-0 left-0 w-full text-center px-2">
        <h5 class="text-black text-3xl font-medium mb-1">{member.name}</h5>
        <p class="secondary-blue font-regular text-xl">{member.role}</p>
      </div>
    </div>

    <div
      class="absolute inset-0 h-full w-full bg-secondary-blue rounded-3xl transform-[rotateY(180deg)] backface-hidden p-8 flex flex-col items-center justify-center text-center text-white"
    >
      <div class="absolute top-6 left-6">
        <a
          href={member.linkedinUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="linkedin-link block hover:scale-110 transition-transform duration-300"
        >
          <div>
            <LinkedinIcon class="size-8" />
          </div>
        </a>
      </div>

      <div class="mt-10">
        <h3 class="text-3xl font-bold mb-2">{member.name}</h3>
        <p class="text-xl opacity-90 mb-8">{member.role}</p>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener(
    "astro:page-load",
    () => {
      // Especificamos que es una lista de elementos HTML
      const cards = document.querySelectorAll(".flip-card-container");

      cards.forEach((card) => {
        card.addEventListener("click", function (this: HTMLElement, e) {
          const inner = this.querySelector(".flip-card-inner");

          const target = e.target as HTMLElement;

          if (!target.closest(".linkedin-link")) {
            inner?.classList.toggle("is-flipped");
          }
        });

        card.addEventListener("mouseleave", function (this: HTMLElement) {
          const inner = this.querySelector(".flip-card-inner");
          inner?.classList.remove("is-flipped");
        });
      });
    },
    { once: false }
  );

  const cards = document.querySelectorAll(".flip-card-container");
  cards.forEach((card) => {
    card.addEventListener("click", function (this: HTMLElement, e) {
      const inner = this.querySelector(".flip-card-inner");
      const target = e.target as HTMLElement;

      if (!target.closest(".linkedin-link")) {
        inner?.classList.toggle("is-flipped");
      }
    });

    card.addEventListener("mouseleave", function (this: HTMLElement) {
      const inner = this.querySelector(".flip-card-inner");
      inner?.classList.remove("is-flipped");
    });
  });
</script>
