---
// src/pages/services/[category].astro
import Layout from "../../layouts/Layout.astro";
import HeroPages from "../../components/common/HeroPages.astro";
import ServiceList from "../../components/services/ServiceList.astro";
import { getNewsletterData, getServicesByCategory } from "../../lib/data";
import Advice from "@/components/common/Advice.astro";
import Newsletter from "@/components/blocks/Newsletter.astro";
import { getHeroPages } from "../../lib/data";
// 1. getStaticPaths: Define qué rutas existen (Obligatorio en modo estático)
export async function getStaticPaths() {
  // Aquí definimos las categorías permitidas.
  // Podrías traerlas de Strapi, pero como son fijas en tu diseño, es mejor hardcodearlas.
  return [
    { params: { category: "software" } },
    { params: { category: "design" } },
    { params: { category: "marketing" } },
  ];
}

// 2. Obtener el parámetro de la URL (lo que está entre corchetes)
const { category } = Astro.params;

// 3. Configuración de textos según la categoría
const categoryData: Record<
  string,
  { badge: string; title: string; metaTitle: string }
> = {
  software: {
    badge: "DESARROLLO DE SOFTWARE",
    title: "Marcamos un antes y un después en tu negocio.",
    metaTitle: "Servicios de Desarrollo de Software",
  },
  design: {
    badge: "DISEÑO CREATIVO",
    title: "Creamos identidades visuales que impactan.",
    metaTitle: "Servicios de Diseño",
  },
  marketing: {
    badge: "MARKETING DIGITAL",
    title: "Impulsamos tu marca hacia el crecimiento.",
    metaTitle: "Servicios de Marketing",
  },
};

// 4. Validación y Fetch de datos
// TypeScript puede quejarse si category es undefined, aseguramos que es string
const currentCategoryKey = category ? category.toLowerCase() : "software";
const currentCategoryData = categoryData[currentCategoryKey];

if (!currentCategoryData) {
  return Astro.redirect("/404");
}
const newsletterData = await getNewsletterData();
const services = await getServicesByCategory(currentCategoryKey);
const globalHero = await getHeroPages();
const serviceHero = globalHero[0];
const heroProps = serviceHero
  ? {
      title: serviceHero.title,
      description: serviceHero.description,
    }
  : null;
---

<Layout title={currentCategoryData.metaTitle}>
  <main>
    {heroProps && <HeroPages {...heroProps} />}
    {/* Componente Lista Dinámica */}
    <ServiceList
      badge={currentCategoryData.badge}
      title={currentCategoryData.title}
      services={services}
    />
  </main>
  <Advice />

  {
    newsletterData && (
      <div class="relative z-10 -mt-24 mb-10">
        <Newsletter {...newsletterData} />
      </div>
    )
  }
</Layout>
