---
import Advice from "@/components/common/Advice.astro";
import Layout from "@/layouts/Layout.astro";
import { getHeroPages } from "@/lib/globalData";
import { getHomePageData } from "@/lib/homeData";
import { getProjects } from "@/lib/projectData";
import Newsletter from "@/components/common/Newsletter.astro";
import type { NewsletterBlock } from "@/types/index";
import HeroPages from "@/components/common/HeroPages.astro";
import ProjectCard from "@/components/projects/projectCard.astro";
// 1. Import i18n utilities
import { useTranslations } from "@/i18n/utils";

// 2. Generate paths for English and Spanish
export async function getStaticPaths() {
  return [{ params: { lang: "es-AR" } }, { params: { lang: "en" } }];
}

// 3. Get current language
const { lang } = Astro.params;
const t = useTranslations(lang as any);

// 4. Fetch data using the current language
const projects = await getProjects(lang);
const { blocks } = await getHomePageData(lang); // For newsletter
const globalHero = await getHeroPages(lang);
// 5. Find the 'projects' hero (Ensure slug is 'projects' in both locales in Strapi)
const projectHero = globalHero.find((hero) => hero.slug === "projects");

const heroProps = projectHero
  ? {
      title: projectHero.title,
      description: projectHero.description,
      backgroundImage: projectHero.backgroundImage,
    }
  : null;

const newsletterData = blocks?.find(
  (b) => b.__component === "blocks.newsletter"
) as NewsletterBlock | undefined;
---

<Layout title={t("nav.projects")}>
  {heroProps && <HeroPages {...heroProps} />}

  <section class="py-16 md:py-24 bg-white">
    <div class="max-w-full mx-auto">
      {projects?.map((project) => <ProjectCard project={project} />)}
    </div>
  </section>

  <Advice />

  {
    newsletterData && (
      <div class="relative z-10 -mt-24 md:mb-10">
        <Newsletter {...newsletterData} />
      </div>
    )
  }
</Layout>
